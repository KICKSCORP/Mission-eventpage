<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KICKS Mission</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=bcd1514f3b14e52f1b5bf16a2c292216"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        * {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        }
        
        body {
            background: #F5F7FB;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            position: fixed;
        }
        
        .screen {
            width: 100vw;
            min-height: 100vh;
            margin: 0;
            background: #F5F7FB;
            position: relative;
            overflow-y: auto;
        }
        
        .card-glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
        }
        
        .shadow-soft {
            box-shadow: 0 4px 40px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #E91E63 0%, #D81B60 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        @media (max-width: 768px) {
            .screen {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
        
        input[type="text"],
        input[type="tel"],
        input[type="email"] {
            font-size: 16px;
        }
        
        .floating-coin {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        
        .animate-scaleIn {
            animation: scaleIn 0.4s ease-out;
        }
        
        .animate-bounceIn {
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #E91E63 0%, #F06292 100%);
        }
        
        input:focus {
            outline: none;
            border-color: #E91E63;
        }
        
        .modal-backdrop {
            backdrop-filter: blur(12px);
            background: rgba(17, 24, 35, 0.5);
        }
        
        .screen-nav {
            display: none;
        }
        
        @keyframes scan {
            0%, 100% { top: 0; }
            50% { top: 100%; }
        }
    </style>
</head>
<body>
    <!-- Screen Navigation (Hidden on mobile) -->
    <div class="screen-nav">
        <button onclick="showScreen(1)">Start</button>
        <button onclick="showScreen(2)">Profile</button>
        <button onclick="showScreen(3)">Mission</button>
        <button onclick="showScreen(4)">Navigation</button>
        <button onclick="showScreen(5)">QR Scanner</button>
        <button onclick="showScreen(6)">Complete</button>
        <button onclick="showScreen(7)">Reward</button>
    </div>

    <!-- Screen 1: Start Page -->
    <div id="screen1" class="screen">
        <div class="flex flex-col items-center justify-center min-h-screen p-6">
            <!-- Logo -->
            <div class="mb-8">
                <div style="width: 180px; height: 80px; display: flex; align-items: center; justify-content: center;">
                    <img src="/public/logo.png" alt="KICKS" style="width: 180px; height: 80px; object-fit: contain;">
                </div>
            </div>
            
            <!-- Main Card -->
            <div class="card-glass rounded-[24px] p-8 w-full mb-6">
                <h1 class="text-[24px] font-bold text-[#111823] text-center mb-3">
                    Kicks Mission
                </h1>
                <p class="text-[15px] font-medium text-[#6C778A] text-center mb-6">
                    Ï†úÌú¥ Ïπ¥ÌéòÎ•º Î∞©Î¨∏ÌïòÍ≥†<br/>ÎØ∏ÏÖòÏùÑ ÏàòÌñâÌïòÏó¨ Î¶¨ÏõåÎìúÎ•º Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî!
                </p>
                
                <div class="space-y-3 mb-6">
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 rounded-full bg-[#E91E63] bg-opacity-10 flex items-center justify-center flex-shrink-0 mt-0.5">
                            <span class="text-[12px] font-bold text-[#E91E63]">1</span>
                        </div>
                        <p class="text-[14px] text-[#111823] font-medium">Í∞ÑÎã®Ìïú ÌîÑÎ°úÌïÑ ÏûÖÎ†•</p>
                    </div>
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 rounded-full bg-[#E91E63] bg-opacity-10 flex items-center justify-center flex-shrink-0 mt-0.5">
                            <span class="text-[12px] font-bold text-[#E91E63]">2</span>
                        </div>
                        <p class="text-[14px] text-[#111823] font-medium">ÎØ∏ÏÖò ÏãúÏûë</p>
                    </div>
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 rounded-full bg-[#E91E63] bg-opacity-10 flex items-center justify-center flex-shrink-0 mt-0.5">
                            <span class="text-[12px] font-bold text-[#E91E63]">3</span>
                        </div>
                        <p class="text-[14px] text-[#111823] font-medium">Î¶¨ÏõåÎìú Î∞õÍ∏∞</p>
                    </div>
                </div>
            </div>
            
            <!-- CTA Button -->
            <button onclick="showScreen(2)" class="btn-primary w-full h-[52px] rounded-[50px] text-white text-[16px] font-semibold shadow-soft">
                ÏãúÏûëÌïòÍ∏∞
            </button>
        </div>
    </div>

    <!-- Screen 2: Profile Form Page -->
    <div id="screen2" class="screen" style="display: none;">
        <div class="flex flex-col min-h-screen p-6 pt-16">
            <!-- Header -->
            <div class="mb-8 animate-fadeInUp">
                <h1 class="text-[24px] font-bold text-[#111823] mb-2">
                    ÌôòÏòÅÌï©ÎãàÎã§!
                </h1>
                <p class="text-[15px] font-medium text-[#6C778A]">
                    ÎØ∏ÏÖò Ï∞∏Ïó¨Î•º ÏúÑÌï¥ Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî
                </p>
            </div>
            
            <!-- Form Card -->
            <div class="card-glass rounded-[24px] p-6 mb-auto animate-scaleIn" style="animation-delay: 0.1s;">
                <div class="space-y-5">
                    <div>
                        <label class="text-[14px] font-semibold text-[#111823] mb-2 block">Ïù¥Î¶Ñ</label>
                        <input type="text" id="userName" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî" 
                               class="w-full h-[52px] px-4 rounded-[16px] border-2 border-[#E5E8EB] text-[15px] font-medium text-[#111823] placeholder-[#6C778A] transition-all"
                               style="background: #F5F7FB;"
                               oninput="checkFormValidity()">
                    </div>
                    
                    <div>
                        <label class="text-[14px] font-semibold text-[#111823] mb-2 block">Ï†ÑÌôîÎ≤àÌò∏</label>
                        <input type="tel" id="userPhone" placeholder="010-0000-0000" 
                               class="w-full h-[52px] px-4 rounded-[16px] border-2 border-[#E5E8EB] text-[15px] font-medium text-[#111823] placeholder-[#6C778A] transition-all"
                               style="background: #F5F7FB;"
                               oninput="formatPhoneNumber(this)"
                               maxlength="13">
                    </div>
                    
                    <div>
                        <label class="text-[14px] font-semibold text-[#111823] mb-2 block">ÏÑ±Î≥Ñ</label>
                        <div class="flex gap-3">
                            <label class="flex-1 flex items-center justify-center h-[52px] rounded-[16px] border-2 border-[#E5E8EB] cursor-pointer transition-all hover:border-[#E91E63]" style="background: #F5F7FB;">
                                <input type="radio" name="gender" value="male" class="hidden gender-radio" onchange="checkFormValidity()">
                                <span class="text-[15px] font-medium text-[#111823] gender-label">ÎÇ®ÏÑ±</span>
                            </label>
                            <label class="flex-1 flex items-center justify-center h-[52px] rounded-[16px] border-2 border-[#E5E8EB] cursor-pointer transition-all hover:border-[#E91E63]" style="background: #F5F7FB;">
                                <input type="radio" name="gender" value="female" class="hidden gender-radio" onchange="checkFormValidity()">
                                <span class="text-[15px] font-medium text-[#111823] gender-label">Ïó¨ÏÑ±</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 flex items-start gap-3 p-4 rounded-[16px] bg-[#E91E63] bg-opacity-5">
                    <input type="checkbox" id="agreePrivacy" class="mt-0.5 w-5 h-5 rounded border-2 border-[#E5E8EB] cursor-pointer" onchange="checkFormValidity()"
                           style="accent-color: #E91E63;">
                    <label class="text-[12px] font-medium text-[#6C778A] leading-relaxed cursor-pointer">
                        <span onclick="showPrivacyPopup()" class="underline text-[#E91E63] hover:text-[#D81B60]">Í∞úÏù∏Ï†ïÎ≥¥ ÏàòÏßë Î∞è Ïù¥Ïö©Ïóê ÎèôÏùòÌï©ÎãàÎã§.</span> (ÌïÑÏàò)
                    </label>
                </div>
            </div>
            
            <!-- Bottom CTA -->
            <div class="mt-6">
                <button id="nextButton" onclick="showScreen(3)" class="btn-primary w-full h-[52px] rounded-[50px] text-white text-[16px] font-semibold shadow-soft mb-3 opacity-50 cursor-not-allowed" disabled>
                    Îã§Ïùå
                </button>
                <button onclick="showScreen(1)" class="w-full h-[52px] rounded-[50px] text-[#6C778A] text-[15px] font-semibold border-2 border-[#E5E8EB] bg-white">
                    Ïù¥Ï†Ñ
                </button>
            </div>
        </div>
    </div>

    <!-- Privacy Popup (Global) -->
    <div id="privacyPopup" class="fixed inset-0 z-50 flex items-center justify-center p-6" style="display: none; background: rgba(17, 24, 35, 0.5); backdrop-filter: blur(8px);" onclick="hidePrivacyPopup()">
        <div class="card-glass rounded-[24px] p-6 max-w-md w-full animate-scaleIn" onclick="event.stopPropagation()">
            <h3 class="text-[18px] font-bold text-[#111823] mb-4">Í∞úÏù∏Ï†ïÎ≥¥ ÏàòÏßë Î∞è Ïù¥Ïö© ÏïàÎÇ¥</h3>
            
            <div class="space-y-4 mb-6">
                <div>
                    <p class="text-[12px] font-semibold text-[#E91E63] mb-1">ÏàòÏßëÌï≠Î™©</p>
                    <p class="text-[14px] text-[#111823]">Ïù¥Î¶Ñ, Ìú¥ÎåÄÏ†ÑÌôîÎ≤àÌò∏</p>
                </div>
                
                <div>
                    <p class="text-[12px] font-semibold text-[#E91E63] mb-1">Ïù¥Ïö©Î™©Ï†Å</p>
                    <p class="text-[14px] text-[#111823]">ÎØ∏ÏÖò Ï∞∏Ïó¨ ÌôïÏù∏ Î∞è Î¶¨ÏõåÎìú Ï†úÍ≥µ</p>
                </div>
                
                <div>
                    <p class="text-[12px] font-semibold text-[#E91E63] mb-1">Î≥¥Ïú†Í∏∞Í∞Ñ</p>
                    <p class="text-[14px] text-[#111823]">Ïù¥Î≤§Ìä∏ Ï¢ÖÎ£å ÌõÑ 30Ïùº</p>
                </div>
            </div>
            
            <button onclick="hidePrivacyPopup()" class="btn-primary w-full h-[48px] rounded-[50px] text-white text-[15px] font-semibold">
                ÌôïÏù∏
            </button>
        </div>
    </div>

    <!-- Screen 3: Mission Page -->
    <div id="screen3" class="screen" style="display: none;">
        <div class="flex flex-col min-h-screen p-6 pt-16">
            <!-- Progress Indicator -->
            <div class="mb-8 animate-fadeInUp">
                <div class="relative">
                    <!-- Character Icon -->
                    <div class="absolute -top-10 left-0 transition-all duration-500 ease-out" style="left: 0%; transform: translateX(-50%);">
                        <img src="/public/icon.png" alt="icon" style="width: 32px; height: 32px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); object-fit: contain;">
                    </div>
                    
                    <!-- Progress Bars -->
                    <div class="flex gap-2 mb-4">
                        <div class="h-1 flex-1 progress-bar rounded-full"></div>
                        <div class="h-1 flex-1 bg-[#E5E8EB] rounded-full"></div>
                        <div class="h-1 flex-1 bg-[#E5E8EB] rounded-full"></div>
                    </div>
                </div>
                <p class="text-[12px] font-semibold text-[#6C778A]">Mission 1/3</p>
            </div>
            
            <!-- Mission Card -->
            <div class="card-glass rounded-[24px] p-8 mb-6 animate-scaleIn" style="animation-delay: 0.1s;">
                <!-- Icon - Location Pin -->
                <div class="flex justify-center mb-6">
                    <svg width="100" height="120" viewBox="0 0 100 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- Ground Shadow -->
                        <ellipse cx="50" cy="110" rx="28" ry="6" fill="rgba(0,0,0,0.12)"/>
                        
                        <g filter="url(#tossPinShadow)">
                            <!-- Pin Bottom Dark Layer (3D depth) -->
                            <path d="M50 15C35.641 15 24 26.641 24 41C24 59 50 90 50 90C50 90 76 59 76 41C76 26.641 64.359 15 50 15Z" 
                                  fill="url(#pinDarkLayer)"/>
                            
                            <!-- Pin Main Body -->
                            <path d="M50 12C35.641 12 24 23.641 24 38C24 56 50 85 50 85C50 85 76 56 76 38C76 23.641 64.359 12 50 12Z" 
                                  fill="url(#pinMainGradient)"/>
                            
                            <!-- Pin Left Highlight -->
                            <path d="M50 12C35.641 12 24 23.641 24 38C24 56 50 85 50 85C50 85 76 56 76 38C76 23.641 64.359 12 50 12Z" 
                                  fill="url(#pinLeftHighlight)" 
                                  opacity="0.5"/>
                            
                            <!-- Pin Top Highlight Shine -->
                            <ellipse cx="42" cy="28" rx="10" ry="12" 
                                     fill="url(#pinTopShine)" 
                                     opacity="0.6"/>
                            
                            <!-- Inner Circle Shadow -->
                            <circle cx="50" cy="39" r="16" fill="rgba(0,0,0,0.1)"/>
                            
                            <!-- Inner Circle Base -->
                            <circle cx="50" cy="38" r="16" fill="url(#innerCircleGradient)"/>
                            
                            <!-- Inner Circle Highlight -->
                            <circle cx="50" cy="38" r="16" fill="url(#innerCircleShine)" opacity="0.4"/>
                            
                            <!-- Center Icon Shadow -->
                            <circle cx="50" cy="39" r="10" fill="rgba(233, 30, 99, 0.3)"/>
                            
                            <!-- Center Icon -->
                            <circle cx="50" cy="38" r="10" fill="url(#centerIconGradient)"/>
                            
                            <!-- Center Symbol -->
                            <path d="M46 38L49 41L54 34" 
                                  stroke="white" 
                                  stroke-width="2.5" 
                                  stroke-linecap="round" 
                                  stroke-linejoin="round"
                                  filter="url(#symbolGlow)"/>
                        </g>
                        
                        <defs>
                            <!-- Main Pin Gradients -->
                            <radialGradient id="pinMainGradient" cx="0.35" cy="0.3">
                                <stop offset="0%" stop-color="#FFE082"/>
                                <stop offset="40%" stop-color="#FFD54F"/>
                                <stop offset="70%" stop-color="#FFC107"/>
                                <stop offset="100%" stop-color="#FFA000"/>
                            </radialGradient>
                            
                            <linearGradient id="pinDarkLayer" x1="50" y1="15" x2="50" y2="90">
                                <stop offset="0%" stop-color="#FF8F00"/>
                                <stop offset="100%" stop-color="#F57C00"/>
                            </linearGradient>
                            
                            <linearGradient id="pinLeftHighlight" x1="24" y1="20" x2="45" y2="50">
                                <stop offset="0%" stop-color="#FFF9C4"/>
                                <stop offset="100%" stop-color="#FFD54F" stop-opacity="0"/>
                            </linearGradient>
                            
                            <radialGradient id="pinTopShine">
                                <stop offset="0%" stop-color="#FFFFFF"/>
                                <stop offset="100%" stop-color="#FFF9C4" stop-opacity="0"/>
                            </radialGradient>
                            
                            <!-- Inner Circle Gradients -->
                            <radialGradient id="innerCircleGradient" cx="0.4" cy="0.3">
                                <stop offset="0%" stop-color="#FFFFFF"/>
                                <stop offset="50%" stop-color="#FFF9C4"/>
                                <stop offset="100%" stop-color="#FFECB3"/>
                            </radialGradient>
                            
                            <radialGradient id="innerCircleShine" cx="0.3" cy="0.2">
                                <stop offset="0%" stop-color="#FFFFFF"/>
                                <stop offset="100%" stop-color="#FFFFFF" stop-opacity="0"/>
                            </radialGradient>
                            
                            <!-- Center Icon Gradient -->
                            <radialGradient id="centerIconGradient" cx="0.35" cy="0.3">
                                <stop offset="0%" stop-color="#F06292"/>
                                <stop offset="100%" stop-color="#E91E63"/>
                            </radialGradient>
                            
                            <!-- Filters -->
                            <filter id="tossPinShadow" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="4"/>
                                <feOffset dx="0" dy="6" result="offsetblur"/>
                                <feComponentTransfer>
                                    <feFuncA type="linear" slope="0.25"/>
                                </feComponentTransfer>
                                <feMerge>
                                    <feMergeNode/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                            
                            <filter id="symbolGlow">
                                <feGaussianBlur stdDeviation="1" result="coloredBlur"/>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                    </svg>
                </div>
                
                <h2 class="text-[24px] font-bold text-[#111823] mb-3">
                    Ïò§ÎäòÏùò ÎØ∏ÏÖò
                </h2>
                <p class="text-[15px] font-medium text-[#6C778A] mb-8 leading-relaxed">
                    ÌÇ•Ïä§ Ï†úÌú¥ Ïπ¥Ìéò Î∞©Î¨∏ÌïòÍ≥† QRÏΩîÎìúÎ•º Ï¥¨ÏòÅÌïòÍ∏∞!
                </p>
                
                <!-- Mission Details -->
                <div class="space-y-3">
                    <div class="flex items-center gap-3 p-4 rounded-[16px]" style="background: #F5F7FB;">
                        <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center">
                            <span class="text-[16px]">üìç</span>
                        </div>
                        <div>
                            <p class="text-[12px] font-semibold text-[#6C778A]">ÏúÑÏπò</p>
                            <p class="text-[14px] font-bold text-[#111823]">Ïπ¥ÌéòÏò®Ïñë</p>
                            <p class="text-[12px] text-[#6C778A] mt-0.5">Ï∂©ÎÇ® ÏïÑÏÇ∞Ïãú Ï∂©Î¨¥Î°ú 123 Ïò®ÏñëÏπ¥Ìéò</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3 p-4 rounded-[16px]" style="background: #F5F7FB;">
                        <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center">
                            <span class="text-[16px]">‚è±Ô∏è</span>
                        </div>
                        <div>
                            <p class="text-[12px] font-semibold text-[#6C778A]">ÏòàÏÉÅ ÏÜåÏöî ÏãúÍ∞Ñ</p>
                            <p class="text-[14px] font-bold text-[#111823]">10Î∂Ñ</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CTA -->
            <button onclick="showScreen(4)" class="btn-primary w-full h-[52px] rounded-[50px] text-white text-[16px] font-semibold shadow-soft mt-auto">
                ÎØ∏ÏÖò ÏãúÏûëÌïòÍ∏∞
            </button>
        </div>
    </div>

    <!-- Screen 4: Navigation Page -->
    <div id="screen4" class="screen" style="display: none;">
        <div class="flex flex-col min-h-screen p-6 pt-16">
            <!-- Progress Indicator -->
            <div class="mb-6 animate-fadeInUp">
                <div class="relative">
                    <!-- Character Icon -->
                    <div class="absolute -top-10 transition-all duration-500 ease-out" style="left: 50%; transform: translateX(-50%);">
                        <img src="/public/icon.png" alt="icon" style="width: 32px; height: 32px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); object-fit: contain;">
                    </div>
                    
                    <!-- Progress Bars -->
                    <div class="flex gap-2 mb-4">
                        <div class="h-1 flex-1 progress-bar rounded-full"></div>
                        <div class="h-1 flex-1 progress-bar rounded-full"></div>
                        <div class="h-1 flex-1 bg-[#E5E8EB] rounded-full"></div>
                    </div>
                </div>
                <p class="text-[12px] font-semibold text-[#6C778A]">Mission 2/3</p>
            </div>
            
            <!-- Header -->
            <div class="mb-6">
                <h1 class="text-[24px] font-bold text-[#111823] mb-2">
                    Î™©Ï†ÅÏßÄÎ°ú Ïù¥ÎèôÌïòÏÑ∏Ïöî
                </h1>
                <p class="text-[15px] font-medium text-[#6C778A]">
                    QR ÏΩîÎìúÎ•º Ï∞æÏïÑ Ïä§Ï∫îÌï¥Ï£ºÏÑ∏Ïöî
                </p>
            </div>
            
            <!-- Map Container -->
            <div class="card-glass rounded-[24px] p-4 mb-6 animate-scaleIn" style="animation-delay: 0.1s;">
                <!-- Kakao Map -->
                <div id="kakaoMap" class="w-full h-[320px] rounded-[16px] mb-4 relative" style="background: #E5E8EB; overflow: hidden;">
                    <div class="absolute inset-0 flex items-center justify-center text-[#6C778A] text-[14px]">
                        ÏßÄÎèÑ Î°úÎî© Ï§ë...
                    </div>
                </div>
                
                <!-- Distance Info -->
                <div class="flex items-center justify-between p-4 rounded-[16px]" style="background: #F5F7FB;">
                    <div>
                        <p class="text-[12px] font-semibold text-[#6C778A] mb-1">ÎÇ®ÏùÄ Í±∞Î¶¨</p>
                        <p id="distanceText" class="text-[16px] font-bold text-[#111823]">Í≥ÑÏÇ∞ Ï§ë...</p>
                    </div>
                    <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M10 4V16M10 4L6 8M10 4L14 8" stroke="#E91E63" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
                
                <!-- Direction Info -->
                <div class="flex items-center justify-between p-4 rounded-[16px] mt-3" style="background: #F5F7FB;">
                    <div>
                        <p class="text-[12px] font-semibold text-[#6C778A] mb-1">ÏòàÏÉÅ ÏÜåÏöî ÏãúÍ∞Ñ</p>
                        <p id="timeText" class="text-[16px] font-bold text-[#111823]">ÎèÑÎ≥¥ ÏïΩ 2Î∂Ñ</p>
                    </div>
                </div>
            </div>
            
            <!-- CTA -->
            <button onclick="showScreen(5)" class="btn-primary w-full h-[52px] rounded-[50px] text-white text-[16px] font-semibold shadow-soft">
                QR Ïä§Ï∫îÌïòÍ∏∞
            </button>
        </div>
    </div>

    <!-- Screen 5: QR Scanner Page -->
    <div id="screen5" class="screen" style="display: none;">
        <div class="flex flex-col items-center justify-center min-h-screen p-6 relative">
            
            <!-- QR Scanner Container -->
            <div class="w-full max-w-[320px] mb-8">
                <!-- Camera View -->
                <div id="qr-reader" class="w-full rounded-[24px] overflow-hidden" style="background: #1a1a1a;"></div>
                
                <!-- Scanning Status -->
                <div id="qr-status" class="mt-4 text-center">
                    <p class="text-[14px] font-medium text-[#6C778A]">Ïπ¥Î©îÎùºÎ•º QR ÏΩîÎìúÏóê ÎßûÏ∂∞Ï£ºÏÑ∏Ïöî</p>
                </div>
            </div>
            
            <!-- Instructions -->
            <div class="card-glass rounded-[24px] p-6 w-full mb-6 text-center">
                <h2 class="text-[20px] font-bold text-[#111823] mb-2">
                    QR ÏΩîÎìúÎ•º Ïä§Ï∫îÌïòÏÑ∏Ïöî
                </h2>
                <p class="text-[14px] font-medium text-[#6C778A]">
                    ÌîÑÎ†àÏûÑ ÏïàÏóê QR ÏΩîÎìúÎ•º ÎßûÏ∂∞Ï£ºÏÑ∏Ïöî
                </p>
            </div>
            
            <!-- Test Buttons (Í∞úÎ∞úÏö© - Î∞∞Ìè¨ Ïãú ÏÇ≠Ï†ú) -->
            <div class="w-full space-y-3 mb-4 p-4 rounded-[16px]" style="background: rgba(255, 193, 7, 0.1); border: 2px dashed #FFC107;">
                <p class="text-[12px] font-bold text-[#FF9800] text-center mb-2">üß™ ÌÖåÏä§Ìä∏Ïö© Î≤ÑÌäº</p>
                <button onclick="testQrSuccess()" class="w-full h-[48px] rounded-[50px] bg-[#4CAF50] text-white text-[14px] font-semibold">
                    ‚úì Ïä§Ï∫î ÏÑ±Í≥µ ÌÖåÏä§Ìä∏
                </button>
                <button onclick="testQrFailure()" class="w-full h-[48px] rounded-[50px] bg-[#FF5722] text-white text-[14px] font-semibold">
                    ‚úó Ïä§Ï∫î Ïã§Ìå® ÌÖåÏä§Ìä∏
                </button>
            </div>
            
            <!-- Action Button -->
            <button onclick="stopQrScanner(); showScreen(4)" class="w-full h-[52px] rounded-[50px] text-[#6C778A] text-[15px] font-semibold border-2 border-[#E5E8EB] bg-white">
                Ï∑®ÏÜå
            </button>
        </div>
        
        <!-- QR Failure Popup -->
        <div id="qrFailurePopup" class="fixed inset-0 z-50 flex items-center justify-center p-6" style="display: none; background: rgba(17, 24, 35, 0.5); backdrop-filter: blur(8px);" onclick="hideQrFailurePopup()">
            <div class="card-glass rounded-[24px] p-8 max-w-sm w-full animate-scaleIn text-center" onclick="event.stopPropagation()">
                <div class="w-16 h-16 rounded-full bg-[#FF5722] bg-opacity-10 flex items-center justify-center mx-auto mb-4">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <path d="M16 8V16M16 20V20.5" stroke="#FF5722" stroke-width="3" stroke-linecap="round"/>
                    </svg>
                </div>
                
                <h3 class="text-[20px] font-bold text-[#111823] mb-2">Ïù∏Ïãù Ïã§Ìå®</h3>
                <p class="text-[15px] text-[#6C778A] mb-6">
                    QR ÏΩîÎìúÎ•º Îã§Ïãú Ï¥¨ÏòÅÌï¥Ï£ºÏÑ∏Ïöî
                </p>
                
                <button onclick="hideQrFailurePopup()" class="btn-primary w-full h-[48px] rounded-[50px] text-white text-[15px] font-semibold">
                    Îã§Ïãú ÏãúÎèÑ
                </button>
            </div>
        </div>
    </div>

    <!-- Screen 6: Mission Complete Page -->
    <div id="screen6" class="screen" style="display: none;">
        <div class="flex flex-col min-h-screen p-6 pt-16 relative" style="background: #F8F9FA;">
            <!-- Confetti Canvas -->
            <canvas id="confetti-canvas" class="absolute inset-0 pointer-events-none" style="width: 100%; height: 100%; z-index: 1;"></canvas>
            
            <!-- Progress Indicator - Minimal -->
            <div class="mb-8 animate-fadeInUp" style="position: relative; z-index: 2;">
                <div class="relative">
                    <!-- Character Icon -->
                    <div class="absolute -top-10 transition-all duration-500 ease-out" style="left: 100%; transform: translateX(-50%);">
                        <img src="/public/icon.png" alt="icon" style="width: 32px; height: 32px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); object-fit: contain;">
                    </div>
                    
                    <div class="flex gap-2 mb-4">
                        <div class="h-1 flex-1 rounded-full" style="background: #E91E63;"></div>
                        <div class="h-1 flex-1 rounded-full" style="background: #E91E63;"></div>
                        <div class="h-1 flex-1 rounded-full" style="background: #E91E63;"></div>
                    </div>
                </div>
                <p class="text-[12px] font-semibold text-[#6C778A]">Mission 3/3</p>
            </div>
            
            <!-- Main Content Card -->
            <div class="bg-white rounded-[20px] p-6 mb-4" style="box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04); position: relative; z-index: 2; flex: 1;">
                
                <!-- Glassmorphism Check Icon - Pink Palette -->
                <div class="flex justify-center mb-6">
                    <svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- Glass Circle with Pink Gradient -->
                        <defs>
                            <linearGradient id="pinkGlassGradient" x1="0" y1="0" x2="100" y2="100" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="#FCE4EC"/>
                                <stop offset="50%" stop-color="#F8BBD0"/>
                                <stop offset="100%" stop-color="#F48FB1"/>
                            </linearGradient>
                            
                            <linearGradient id="pinkGlassShine" x1="20" y1="20" x2="50" y2="50" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="white" stop-opacity="0.8"/>
                                <stop offset="100%" stop-color="white" stop-opacity="0"/>
                            </linearGradient>
                            
                            <filter id="glassBlur">
                                <feGaussianBlur in="SourceGraphic" stdDeviation="0.5"/>
                            </filter>
                            
                            <filter id="softShadow">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
                                <feOffset dx="0" dy="2" result="offsetblur"/>
                                <feComponentTransfer>
                                    <feFuncA type="linear" slope="0.15"/>
                                </feComponentTransfer>
                                <feMerge>
                                    <feMergeNode/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        
                        <!-- Shadow -->
                        <ellipse cx="50" cy="92" rx="28" ry="4" fill="rgba(233, 30, 99, 0.1)"/>
                        
                        <!-- Main Glass Circle -->
                        <g filter="url(#softShadow)">
                            <circle cx="50" cy="50" r="38" fill="url(#pinkGlassGradient)" opacity="0.9"/>
                            
                            <!-- Inner Glow -->
                            <circle cx="50" cy="50" r="38" fill="url(#pinkGlassShine)"/>
                            
                            <!-- Glass Rim -->
                            <circle cx="50" cy="50" r="38" stroke="white" stroke-width="1.5" opacity="0.5" fill="none"/>
                            
                            <!-- Top Highlight -->
                            <ellipse cx="42" cy="35" rx="15" ry="12" fill="white" opacity="0.4" filter="url(#glassBlur)"/>
                            
                            <!-- Check Mark -->
                            <path d="M35 50L43 58L65 38" 
                                  stroke="white" 
                                  stroke-width="4" 
                                  stroke-linecap="round" 
                                  stroke-linejoin="round"
                                  opacity="0.95"/>
                        </g>
                    </svg>
                </div>
                
                <!-- Title -->
                <h1 class="text-[26px] font-bold text-center mb-2" style="color: #191F28; letter-spacing: -0.3px;">
                    ÎØ∏ÏÖò ÏôÑÎ£å
                </h1>
                <p class="text-[15px] text-center mb-8" style="color: #6B7684; font-weight: 500;">
                    Î™®Îì† ÎØ∏ÏÖòÏùÑ ÏôÑÎ£åÌñàÏñ¥Ïöî
                </p>
                
                <!-- Progress Card - Pink Gradient -->
                <div class="rounded-[16px] p-5 mb-4" style="background: linear-gradient(135deg, #E91E63 0%, #F06292 100%);">
                    <p class="text-[13px] font-semibold text-white opacity-80 text-center mb-3">ÏôÑÎ£åÌïú ÎØ∏ÏÖò</p>
                    <div class="flex items-baseline justify-center gap-2">
                        <span class="text-[48px] font-bold text-white" style="line-height: 1;">3</span>
                        <span class="text-[20px] font-semibold text-white opacity-60">/</span>
                        <span class="text-[28px] font-semibold text-white opacity-60">3</span>
                    </div>
                </div>
                
                <!-- Reward Card -->
                <div class="rounded-[16px] p-5 text-center" style="background: #FFF3F6;">
                    <div class="flex flex-col items-center gap-3">
                        <!-- Simple Coffee Icon -->
                        <div class="w-12 h-12 rounded-full flex items-center justify-center" style="background: white;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#E91E63" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 8h1a4 4 0 0 1 0 8h-1"/>
                                <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/>
                                <line x1="6" y1="1" x2="6" y2="4"/>
                                <line x1="10" y1="1" x2="10" y2="4"/>
                                <line x1="14" y1="1" x2="14" y2="4"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-[14px] font-semibold" style="color: #191F28;">Î¨¥Î£å ÏùåÎ£å Ïø†Ìè∞</p>
                            <p class="text-[12px]" style="color: #8B95A1;">ÌöçÎìù ÏôÑÎ£å</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Buttons - Pink Theme -->
            <div class="mt-auto space-y-3" style="position: relative; z-index: 2;">
                <button onclick="showScreen(7)" class="w-full h-[56px] rounded-[14px] text-white text-[16px] font-semibold transition-all" style="background: #E91E63;">
                    Î¶¨ÏõåÎìú Î∞õÍ∏∞
                </button>
            </div>
        </div>
    </div>

    <!-- Screen 7: Reward Coupon Popup -->
    <div id="screen7" class="screen" style="display: none;">
        <div class="fixed inset-0 z-50 flex items-center justify-center p-4" style="background: rgba(17, 24, 35, 0.7); backdrop-filter: blur(8px); overflow-y: auto;">
            <div class="w-full max-w-[360px] my-auto" style="position: relative; z-index: 2;">
                <!-- Close Button -->
                <button onclick="showScreen(6)" class="absolute -top-12 right-0 text-white text-[24px] font-bold">
                    ‚úï
                </button>
                
                <!-- Main Coupon Container -->
                <div class="bg-white rounded-[20px] overflow-hidden" style="box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); position: relative;">
                    
                    <!-- Top Section with Title and Coffee Icon Combined -->
                    <div class="relative" style="background: linear-gradient(135deg, #FFE5EC 0%, #FFF0F5 100%); padding: 30px 20px 20px;">
                        <!-- Coffee Cup Illustration -->
                        <div class="flex justify-center mb-3">
                            <svg width="90" height="90" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g filter="url(#cupShadow)">
                                    <!-- Cup Body -->
                                    <rect x="30" y="40" width="60" height="50" rx="8" fill="white" stroke="#E91E63" stroke-width="2"/>
                                    
                                    <!-- Coffee Surface -->
                                    <ellipse cx="60" cy="43" rx="28" ry="6" fill="#D4A574"/>
                                    
                                    <!-- Handle -->
                                    <path d="M90 50C90 50 100 50 100 60C100 70 90 70 90 70" stroke="#E91E63" stroke-width="3" stroke-linecap="round" fill="none"/>
                                    
                                    <!-- Steam -->
                                    <path d="M50 28C50 28 48 22 50 18" stroke="#E91E63" stroke-width="2.5" stroke-linecap="round" opacity="0.4"/>
                                    <path d="M60 25C60 25 58 19 60 15" stroke="#E91E63" stroke-width="2.5" stroke-linecap="round" opacity="0.4"/>
                                    <path d="M70 28C70 28 68 22 70 18" stroke="#E91E63" stroke-width="2.5" stroke-linecap="round" opacity="0.4"/>
                                </g>
                                <defs>
                                    <filter id="cupShadow" x="0" y="0" width="120" height="120">
                                        <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
                                        <feOffset dx="0" dy="2"/>
                                        <feComponentTransfer>
                                            <feFuncA type="linear" slope="0.2"/>
                                        </feComponentTransfer>
                                        <feMerge>
                                            <feMergeNode/>
                                            <feMergeNode in="SourceGraphic"/>
                                        </feMerge>
                                    </filter>
                                </defs>
                            </svg>
                        </div>
                        
                        <!-- Title -->
                        <p class="text-[13px] font-semibold text-center" style="color: #E91E63; opacity: 0.9; margin-bottom: 0.25rem;">KICKS MISSION</p>
                        <h2 class="text-[18px] font-bold text-center" style="color: #E91E63;">ÏÑ†Î¨º ÍµêÌôòÍ∂å</h2>
                    </div>
                    
                    <!-- Coupon Amount Section -->
                    <div class="relative py-8 px-6" style="background: white;">
                        <!-- Dashed Line Top -->
                        <div class="absolute top-0 left-0 right-0 h-px" style="background: linear-gradient(to right, #E5E8EB 50%, transparent 50%); background-size: 8px 1px;"></div>
                        
                        <!-- Amount Badge -->
                        <div class="flex justify-center mb-6">
                            <div class="relative">
                                <div class="px-8 py-4 rounded-[16px]" style="background: linear-gradient(135deg, #E91E63 0%, #F06292 100%);">
                                    <p class="text-[12px] font-semibold text-white opacity-80 text-center mb-1">Ìï†Ïù∏ Í∏àÏï°</p>
                                    <p class="text-[36px] font-bold text-white text-center" style="line-height: 1;">5,000Ïõê</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Coupon Info -->
                        <div class="space-y-3 text-center">
                            <div>
                                <p class="text-[18px] font-bold mb-2" style="color: #191F28;">Î¨¥Î£å ÏùåÎ£å Ïø†Ìè∞ ÍµêÌôòÍ∂å</p>
                            </div>
                            
                            <div class="flex items-center justify-center gap-2 py-3 px-4 rounded-[12px]" style="background: #FFF3F6;">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z" stroke="#E91E63" stroke-width="1.5"/>
                                    <path d="M8 5V8L10 10" stroke="#E91E63" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                <p class="text-[13px] font-semibold" style="color: #E91E63;">ÏÇ¨Ïö©Í∏∞Ìïú: ÎãπÏùº ÌïúÏ†ï</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bottom Section with Staff Confirmation -->
                    <div class="relative px-6 py-6" style="background: #FAFBFC;">
                        <!-- Dashed Line Top -->
                        <div class="absolute top-0 left-0 right-0 h-px" style="background: linear-gradient(to right, #E5E8EB 50%, transparent 50%); background-size: 8px 1px;"></div>
                        
                        <!-- Staff Confirmation Button -->
                        <button id="staffConfirmBtn" onclick="confirmStaff()" class="w-full h-[52px] rounded-[12px] text-white text-[15px] font-semibold transition-all mb-6" style="background: linear-gradient(135deg, #E91E63 0%, #D81B60 100%);">
                            ÏßÅÏõê ÌôïÏù∏
                        </button>
                        
                        <!-- Warning Text -->
                        <p class="text-[12px] font-medium text-center mb-4" style="color: #8B95A1; line-height: 1.6;">
                            Î≥∏ Ïø†Ìè∞ÏùÑ ÏßÅÏõêÏóêÍ≤å Î≥¥Ïó¨Ï£ºÏÑ∏Ïöî
                        </p>
                    </div>
                    
                    <!-- Terms and Conditions -->
                    <div class="px-6 py-5" style="background: white; border-top: 1px solid #E5E8EB;">
                        <p class="text-[11px] font-medium leading-relaxed" style="color: #6C778A; line-height: 1.8;">
                            ‚Ä¢ Ïã§ÏàòÎ°úÏù∏Ìï¥ ÏßÅÏõê ÌôïÏù∏ Î≤ÑÌäºÏùÑ ÏßÅÏ†ë ÎàÑÎ•º Í≤ΩÏö∞ Ïø†Ìè∞ Ïû¨Î∞úÌñâÏùÄ Î∂àÍ∞ÄÌï©ÎãàÎã§.<br/>
                            ‚Ä¢ ÏßÅÏõê ÌôïÏù∏Ïù¥ ÏôÑÎ£åÎêú Ïø†Ìè∞ÏùÄ Ïû¨ÏÇ¨Ïö©Ïù¥ Î∂àÍ∞ÄÎä•Ìï©ÎãàÎã§.<br/>
                            ‚Ä¢ 1Ïù∏ 1Ïø†Ìè∞Îßå ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏúºÎ©∞ ÎØ∏ÏÖòÏùÄ Îã§Ïãú ÎèÑÏ†ÑÌï† Ïàò ÏóÜÏäµÎãàÎã§.<br/>
                            ‚Ä¢ Ìï¥Îãπ Ïø†Ìè∞ÏùÄ Ïù¥Î≤§Ìä∏ Ïø†Ìè∞ÏúºÎ°ú ÎãπÏùº ÌïúÏ†ïÏúºÎ°ú ÏÇ¨Ïö©Í∞ÄÎä•Ìï©ÎãàÎã§.
                        </p>
                    </div>
                    
                    <!-- Grayscale Overlay (Hidden by default) - Î∞∞Í≤ΩÎßå ÌùëÎ∞± Ï≤òÎ¶¨ -->
                    <div id="couponOverlay" class="absolute inset-0 rounded-[20px]" style="background: rgba(0, 0, 0, 0.3); display: none; z-index: 10; pointer-events: none;"></div>
                    
                    <!-- Grayscale Filter for content (except stamp) -->
                    <div id="contentGrayscale" class="absolute inset-0 rounded-[20px]" style="background: white; opacity: 0.6; filter: grayscale(100%) brightness(0.95); display: none; z-index: 9; pointer-events: none;"></div>
                    
                    <!-- Stamp Animation Container -->
                    <div id="stampContainer" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; z-index: 20;">
                        <svg id="stampSvg" width="180" height="180" viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g style="animation: stampStamp 0.6s ease-out;">
                                <!-- Outer Circle -->
                                <circle cx="90" cy="90" r="75" stroke="#DC143C" stroke-width="5" fill="none" opacity="0.9" style="transform-origin: center; transform: rotate(-15deg);">
                                    <animate attributeName="stroke-dasharray" from="0 471.2" to="471.2 471.2" dur="0.4s" fill="freeze"/>
                                </circle>
                                
                                <!-- Inner Circle -->
                                <circle cx="90" cy="90" r="65" stroke="#DC143C" stroke-width="4" fill="none" opacity="0.9" style="transform-origin: center; transform: rotate(-15deg);">
                                    <animate attributeName="stroke-dasharray" from="0 408.4" to="408.4 408.4" dur="0.4s" fill="freeze"/>
                                </circle>
                                
                                <!-- Main Text: ÏÇ¨Ïö©ÏôÑÎ£å -->
                                <text x="90" y="95" font-size="24" font-weight="bold" fill="#DC143C" opacity="0.9" text-anchor="middle" style="font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;">
                                    <tspan dy="0">ÏÇ¨Ïö©</tspan><tspan x="90" dy="24">ÏôÑÎ£å</tspan>
                                </text>
                            </g>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
        
        <style>
            @keyframes stampStamp {
                0% {
                    transform: translate(-50%, -50%) scale(0) rotate(-15deg);
                    opacity: 0;
                }
                50% {
                    transform: translate(-50%, -50%) scale(1.1) rotate(-15deg);
                    opacity: 1;
                }
                100% {
                    transform: translate(-50%, -50%) scale(1) rotate(-15deg);
                    opacity: 1;
                }
            }
        </style>
    </div>

    <script>
        function formatPhoneNumber(input) {
            let numbers = input.value.replace(/[^0-9]/g, '');
            let formatted = '';
            
            if (numbers.length <= 3) {
                formatted = numbers;
            } else if (numbers.length <= 7) {
                formatted = numbers.slice(0, 3) + '-' + numbers.slice(3);
            } else {
                formatted = numbers.slice(0, 3) + '-' + numbers.slice(3, 7) + '-' + numbers.slice(7, 11);
            }
            
            input.value = formatted;
            checkFormValidity();
        }
        
        function showPrivacyPopup() {
            document.getElementById('privacyPopup').style.display = 'flex';
        }
        
        function hidePrivacyPopup() {
            document.getElementById('privacyPopup').style.display = 'none';
        }
        
        function checkFormValidity() {
            const name = document.getElementById('userName').value.trim();
            const phone = document.getElementById('userPhone').value.trim();
            const genderSelected = document.querySelector('input[name="gender"]:checked');
            const agreeChecked = document.getElementById('agreePrivacy').checked;
            const nextButton = document.getElementById('nextButton');
            
            document.querySelectorAll('.gender-radio').forEach(radio => {
                const label = radio.parentElement;
                if (radio.checked) {
                    label.style.borderColor = '#E91E63';
                    label.style.background = 'rgba(233, 30, 99, 0.05)';
                } else {
                    label.style.borderColor = '#E5E8EB';
                    label.style.background = '#F5F7FB';
                }
            });
            
            if (name && phone && genderSelected && agreeChecked) {
                nextButton.disabled = false;
                nextButton.classList.remove('opacity-50', 'cursor-not-allowed');
                nextButton.classList.add('cursor-pointer');
            } else {
                nextButton.disabled = true;
                nextButton.classList.add('opacity-50', 'cursor-not-allowed');
                nextButton.classList.remove('cursor-pointer');
            }
        }
        
        function testQrSuccess() {
            const statusElement = document.getElementById('qr-status');
            statusElement.innerHTML = '<p class="text-[16px] font-bold text-[#4CAF50]">‚úì Ïù∏Ïãù ÏôÑÎ£å!</p>';
            
            if (navigator.vibrate) {
                navigator.vibrate(200);
            }
            
            setTimeout(() => {
                stopQrScanner();
                showScreen(6);
            }, 500);
        }
        
        function testQrFailure() {
            showQrFailurePopup();
        }
        
        function showQrFailurePopup() {
            document.getElementById('qrFailurePopup').style.display = 'flex';
        }
        
        function hideQrFailurePopup() {
            document.getElementById('qrFailurePopup').style.display = 'none';
            const statusElement = document.getElementById('qr-status');
            statusElement.innerHTML = '<p class="text-[14px] font-medium text-[#6C778A]">Ïπ¥Î©îÎùºÎ•º QR ÏΩîÎìúÏóê ÎßûÏ∂∞Ï£ºÏÑ∏Ïöî</p>';
        }
        
        let html5QrCode = null;
        
        function showScreen(screenNum) {
            for (let i = 1; i <= 7; i++) {
                const screen = document.getElementById('screen' + i);
                if (screen) {
                    screen.style.display = 'none';
                }
            }
            
            const selectedScreen = document.getElementById('screen' + screenNum);
            if (selectedScreen) {
                selectedScreen.style.display = 'block';
            }
            
            if (screenNum === 4) {
                setTimeout(() => {
                    initKakaoMap();
                }, 100);
            }
            
            if (screenNum === 5) {
                setTimeout(() => {
                    startQrScanner();
                }, 100);
            } else {
                stopQrScanner();
            }
            
            if (screenNum === 6) {
                setTimeout(() => {
                    createConfetti();
                }, 300);
            }
        }
        
        function startQrScanner() {
            const qrReader = document.getElementById('qr-reader');
            const qrStatus = document.getElementById('qr-status');
            
            if (!qrReader) return;
            
            if (html5QrCode && html5QrCode.isScanning) {
                return;
            }
            
            html5QrCode = new Html5Qrcode("qr-reader");
            
            const config = {
                fps: 10,
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0
            };
            
            html5QrCode.start(
                { facingMode: "environment" },
                config,
                (decodedText, decodedResult) => {
                    console.log('QR ÏΩîÎìú Ïù∏Ïãù:', decodedText);
                    onQrCodeScanned(decodedText);
                },
                (errorMessage) => {
                }
            ).catch((err) => {
                console.error('Ïπ¥Î©îÎùº ÏãúÏûë Ïò§Î•ò:', err);
                qrStatus.innerHTML = '<p class="text-[14px] font-medium text-[#E91E63]">Ïπ¥Î©îÎùºÎ•º ÏãúÏûëÌï† Ïàò ÏóÜÏäµÎãàÎã§. Í∂åÌïúÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.</p>';
            });
        }
        
        function stopQrScanner() {
            if (html5QrCode && html5QrCode.isScanning) {
                html5QrCode.stop().then(() => {
                    html5QrCode.clear();
                    html5QrCode = null;
                }).catch((err) => {
                    console.error('Ïä§Ï∫êÎÑà Ï†ïÏßÄ Ïò§Î•ò:', err);
                });
            }
        }
        
        function onQrCodeScanned(qrData) {
            const statusElement = document.getElementById('qr-status');
            statusElement.innerHTML = '<p class="text-[16px] font-bold text-[#4CAF50]">‚úì Ïù∏Ïãù ÏôÑÎ£å!</p>';
            
            const isValid = validateQrCode(qrData);
            
            if (isValid) {
                stopQrScanner();
                
                if (navigator.vibrate) {
                    navigator.vibrate(200);
                }
                
                setTimeout(() => {
                    showScreen(6);
                }, 500);
            } else {
                showQrFailurePopup();
            }
        }
        
        function validateQrCode(qrData) {
            return true;
        }
        
        function initKakaoMap() {
            if (typeof kakao === 'undefined' || !kakao.maps) {
                alert('Ïπ¥Ïπ¥Ïò§ÎßµÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const startPoint = { lat: 36.79200648461397, lng: 127.00640590874339 };
            const endPoint = { lat: 36.79279487214459, lng: 127.0078597132105 };
            
            const container = document.getElementById('kakaoMap');
            if (!container) return;
            
            const centerLat = (startPoint.lat + endPoint.lat) / 2;
            const centerLng = (startPoint.lng + endPoint.lng) / 2;
            
            const options = {
                center: new kakao.maps.LatLng(centerLat, centerLng),
                level: 3
            };
            
            const map = new kakao.maps.Map(container, options);
            
            const startMarkerImage = new kakao.maps.MarkerImage(
                'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png',
                new kakao.maps.Size(24, 35)
            );
            
            const startMarker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(startPoint.lat, startPoint.lng),
                map: map,
                image: startMarkerImage
            });
            
            const startInfo = new kakao.maps.InfoWindow({
                content: '<div style="padding:8px 12px;font-size:13px;font-weight:600;background:#E91E63;color:white;border-radius:8px;">Ï∂úÎ∞úÏßÄ</div>',
                removable: false
            });
            startInfo.open(map, startMarker);
            
            const endMarkerImage = new kakao.maps.MarkerImage(
                'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png',
                new kakao.maps.Size(24, 35)
            );
            
            const endMarker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(endPoint.lat, endPoint.lng),
                map: map,
                image: endMarkerImage
            });
            
            const endInfo = new kakao.maps.InfoWindow({
                content: '<div style="padding:8px 12px;font-size:13px;font-weight:600;background:#4CAF50;color:white;border-radius:8px;">Ïò®ÏñëÏπ¥Ìéò üéØ</div>',
                removable: false
            });
            endInfo.open(map, endMarker);
            
            const linePath = [
                new kakao.maps.LatLng(startPoint.lat, startPoint.lng),
                new kakao.maps.LatLng(endPoint.lat, endPoint.lng)
            ];
            
            const polyline = new kakao.maps.Polyline({
                path: linePath,
                strokeWeight: 4,
                strokeColor: '#E91E63',
                strokeOpacity: 0.8,
                strokeStyle: 'solid'
            });
            
            polyline.setMap(map);
            
            const distance = calculateDistance(
                startPoint.lat, startPoint.lng,
                endPoint.lat, endPoint.lng
            );
            
            document.getElementById('distanceText').textContent = `ÏïΩ ${distance}m ÎÇ®Ïùå`;
            
            const minutes = Math.ceil(distance / 67);
            document.getElementById('timeText').textContent = `ÎèÑÎ≥¥ ÏïΩ ${minutes}Î∂Ñ`;
            
            requestLocationPermission(map, endPoint);
        }
        
        function requestLocationPermission(map, endPoint) {
            // ÏúÑÏπò Í∂åÌïú ÏöîÏ≤≠ ÏóÜÏùå - ÏßÄÎèÑÎßå ÌëúÏãú
            console.log('ÏßÄÎèÑ ÌëúÏãú ÏôÑÎ£å');
        }
        
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371000;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            return Math.round(distance);
        }
        
        let currentLocationMarker = null;
        let locationWatchId = null;
        
        function startLocationTracking(map, endPoint) {
            // ÏúÑÏπò Ï∂îÏ†Å ÏóÜÏùå - Ï†ïÏ†ÅÏù∏ ÏßÄÎèÑÎßå ÌëúÏãú
            console.log('ÏßÄÎèÑ Ï§ÄÎπÑ ÏôÑÎ£å');
        }
        
        function createConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            const confetti = [];
            const confettiCount = 50;
            const colors = ['#E91E63', '#F06292', '#F9D45A', '#FFE066'];
            
            for (let i = 0; i < confettiCount; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    r: Math.random() * 6 + 2,
                    d: Math.random() * confettiCount,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    tilt: Math.floor(Math.random() * 10) - 10,
                    tiltAngleIncremental: Math.random() * 0.07 + 0.05,
                    tiltAngle: 0
                });
            }
            
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                confetti.forEach((c, i) => {
                    ctx.beginPath();
                    ctx.lineWidth = c.r / 2;
                    ctx.strokeStyle = c.color;
                    ctx.moveTo(c.x + c.tilt + c.r, c.y);
                    ctx.lineTo(c.x + c.tilt, c.y + c.tilt + c.r);
                    ctx.stroke();
                    
                    c.tiltAngle += c.tiltAngleIncremental;
                    c.y += (Math.cos(c.d) + 3 + c.r / 2) / 2;
                    c.x += Math.sin(c.d);
                    c.tilt = Math.sin(c.tiltAngle - i / 3) * 15;
                    
                    if (c.y > canvas.height) {
                        confetti[i] = {
                            x: Math.random() * canvas.width,
                            y: -10,
                            r: c.r,
                            d: c.d,
                            color: c.color,
                            tilt: c.tilt,
                            tiltAngleIncremental: c.tiltAngleIncremental,
                            tiltAngle: c.tiltAngle
                        };
                    }
                });
                
                requestAnimationFrame(draw);
            }
            
            draw();
        }
        
        showScreen(1);
        
        function confirmStaff() {
            const overlay = document.getElementById('couponOverlay');
            const contentGrayscale = document.getElementById('contentGrayscale');
            const stampContainer = document.getElementById('stampContainer');
            const staffConfirmBtn = document.getElementById('staffConfirmBtn');
            
            // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            staffConfirmBtn.disabled = true;
            staffConfirmBtn.style.opacity = '0.5';
            staffConfirmBtn.style.cursor = 'not-allowed';
            
            // ÎèÑÏû• ÌëúÏãú
            stampContainer.style.display = 'block';
            
            // 0.6Ï¥à ÌõÑ Î∞∞Í≤ΩÎßå ÌùëÎ∞± Ï≤òÎ¶¨
            setTimeout(() => {
                overlay.style.display = 'block';
                contentGrayscale.style.display = 'block';
            }, 600);
            
            // 10Ï¥à ÌõÑ Ï≤´ ÌôîÎ©¥ÏúºÎ°ú ÏûêÎèô Ïù¥Îèô
            setTimeout(() => {
                showScreen(1);
            }, 10000);
        }
    </script>
</body>
</html>
